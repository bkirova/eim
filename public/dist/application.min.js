"use strict";var ApplicationConfiguration=function(){var applicationModuleName="emotion-in-motion",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","vr.directives.slider","cfp.hotkeys","btford.socket-io","gettext"],registerModule=function(moduleName){angular.module(moduleName,[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["gettextCatalog",function(gettextCatalog){gettextCatalog.setCurrentLanguage("en"),gettextCatalog.debug=!0}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("angular-hotkeys"),ApplicationConfiguration.registerModule("core"),function(){angular.module("cfp.hotkeys",[]).provider("hotkeys",function(){this.includeCheatSheet=!0,this.templateTitle="Keyboard Shortcuts:",this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title">{{ title }}</h4><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()">×</div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="Show / hide this help menu",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function($rootElement,$rootScope,$compile,$window,$document){function symbolize(combo){var map={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓","return":"↩",backspace:"⌫"};combo=combo.split("+");for(var i=0;i<combo.length;i++)"mod"===combo[i]&&(combo[i]=$window.navigator&&$window.navigator.platform.indexOf("Mac")>=0?"command":"ctrl"),combo[i]=map[combo[i]]||combo[i];return combo.join(" + ")}function Hotkey(combo,description,callback,action,allowIn,persistent){this.combo=combo instanceof Array?combo:[combo],this.description=description,this.callback=callback,this.action=action,this.allowIn=allowIn,this.persistent=persistent}function purgeHotkeys(){for(var i=scope.hotkeys.length;i--;){var hotkey=scope.hotkeys[i];hotkey&&!hotkey.persistent&&_del(hotkey)}}function toggleCheatSheet(){scope.helpVisible=!scope.helpVisible,scope.helpVisible?(previousEsc=_get("esc"),_del("esc"),_add("esc",previousEsc.description,toggleCheatSheet)):(_del("esc"),previousEsc!==!1&&_add(previousEsc))}function _add(combo,description,callback,action,allowIn,persistent){var _callback,preventIn=["INPUT","SELECT","TEXTAREA"],objType=Object.prototype.toString.call(combo);if("[object Object]"===objType&&(description=combo.description,callback=combo.callback,action=combo.action,persistent=combo.persistent,allowIn=combo.allowIn,combo=combo.combo),description instanceof Function?(action=callback,callback=description,description="$$undefined$$"):angular.isUndefined(description)&&(description="$$undefined$$"),void 0===persistent&&(persistent=!0),"function"==typeof callback){_callback=callback,allowIn instanceof Array||(allowIn=[]);for(var index,i=0;i<allowIn.length;i++)allowIn[i]=allowIn[i].toUpperCase(),index=preventIn.indexOf(allowIn[i]),-1!==index&&preventIn.splice(index,1);callback=function(event){var shouldExecute=!0,target=event.target||event.srcElement,nodeName=target.nodeName.toUpperCase();if((" "+target.className+" ").indexOf(" mousetrap ")>-1)shouldExecute=!0;else for(var i=0;i<preventIn.length;i++)if(preventIn[i]===nodeName){shouldExecute=!1;break}shouldExecute&&wrapApply(_callback.apply(this,arguments))}}"string"==typeof action?Mousetrap.bind(combo,wrapApply(callback),action):Mousetrap.bind(combo,wrapApply(callback));var hotkey=new Hotkey(combo,description,callback,action,allowIn,persistent);return scope.hotkeys.push(hotkey),hotkey}function _del(hotkey){var combo=hotkey instanceof Hotkey?hotkey.combo:hotkey;if(Mousetrap.unbind(combo),combo instanceof Array){for(var retStatus=!0,i=0;i<combo.length;i++)retStatus=_del(combo[i])&&retStatus;return retStatus}var index=scope.hotkeys.indexOf(_get(combo));return index>-1?(scope.hotkeys[index].combo.length>1?scope.hotkeys[index].combo.splice(scope.hotkeys[index].combo.indexOf(combo),1):scope.hotkeys.splice(index,1),!0):!1}function _get(combo){for(var hotkey,i=0;i<scope.hotkeys.length;i++)if(hotkey=scope.hotkeys[i],hotkey.combo.indexOf(combo)>-1)return hotkey;return!1}function bindTo(scope){return boundScopes[scope.$id]=[],scope.$on("$destroy",function(){for(var i=boundScopes[scope.$id].length;i--;)_del(boundScopes[scope.$id][i]),delete boundScopes[scope.$id][i]}),{add:function(args){var hotkey;return hotkey=arguments.length>1?_add.apply(this,arguments):_add(args),boundScopes[scope.$id].push(hotkey),this}}}function wrapApply(callback){return function(event,combo){if(callback instanceof Array){var funcString=callback[0],route=callback[1];callback=function(){route.scope.$eval(funcString)}}$rootScope.$apply(function(){callback(event,_get(combo))})}}Mousetrap.stopCallback=function(event,element){return(" "+element.className+" ").indexOf(" mousetrap ")>-1?!1:element.contentEditable&&"true"==element.contentEditable},Hotkey.prototype.format=function(){for(var combo=this.combo[0],sequence=combo.split(/[\s]/),i=0;i<sequence.length;i++)sequence[i]=symbolize(sequence[i]);return sequence};var scope=$rootScope.$new();scope.hotkeys=[],scope.helpVisible=!1,scope.title=this.templateTitle,scope.toggleCheatSheet=toggleCheatSheet;var boundScopes=[];if($rootScope.$on("$routeChangeSuccess",function(event,route){purgeHotkeys(),route&&route.hotkeys&&angular.forEach(route.hotkeys,function(hotkey){var callback=hotkey[2];("string"==typeof callback||callback instanceof String)&&(hotkey[2]=[callback,route]),hotkey[5]=!1,_add.apply(this,hotkey)})}),this.includeCheatSheet){var document=$document[0],element=$rootElement[0],helpMenu=angular.element(this.template);_add(this.cheatSheetHotkey,this.cheatSheetDescription,toggleCheatSheet),(element===document||element===document.documentElement)&&(element=document.body),angular.element(element).append($compile(helpMenu)(scope))}var previousEsc=!1,publicApi={add:_add,del:_del,get:_get,bindTo:bindTo,template:this.template,toggleCheatSheet:toggleCheatSheet,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,purgeHotkeys:purgeHotkeys,templateTitle:this.templateTitle};return publicApi}]}).directive("hotkey",["hotkeys",function(hotkeys){return{restrict:"A",link:function(scope,el,attrs){var key,allowIn;angular.forEach(scope.$eval(attrs.hotkey),function(func,hotkey){allowIn="string"==typeof attrs.hotkeyAllowIn?attrs.hotkeyAllowIn.split(/[\s,]+/):[],key=hotkey,hotkeys.add({combo:hotkey,description:attrs.hotkeyDescription,callback:func,action:attrs.hotkeyAction,allowIn:allowIn})}),el.bind("$destroy",function(){hotkeys.del(key)})}}}]).run(["hotkeys",function(){}])}(),function(window,document){function _addEvent(object,type,callback){return object.addEventListener?void object.addEventListener(type,callback,!1):void object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if("keypress"==e.type){var character=String.fromCharCode(e.which);return e.shiftKey||(character=character.toLowerCase()),character}return _MAP[e.which]?_MAP[e.which]:_KEYCODE_MAP[e.which]?_KEYCODE_MAP[e.which]:String.fromCharCode(e.which).toLowerCase()}function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(",")===modifiers2.sort().join(",")}function _resetSequences(doNotReset){doNotReset=doNotReset||{};var key,activeSequences=!1;for(key in _sequenceLevels)doNotReset[key]?activeSequences=!0:_sequenceLevels[key]=0;activeSequences||(_nextExpectedAction=!1)}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i,callback,matches=[],action=e.type;if(!_callbacks[character])return[];for("keyup"==action&&_isModifier(character)&&(modifiers=[character]),i=0;i<_callbacks[character].length;++i)if(callback=_callbacks[character][i],(sequenceName||!callback.seq||_sequenceLevels[callback.seq]==callback.level)&&action==callback.action&&("keypress"==action&&!e.metaKey&&!e.ctrlKey||_modifiersMatch(modifiers,callback.modifiers))){var deleteCombo=!sequenceName&&callback.combo==combination,deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;(deleteCombo||deleteSequence)&&_callbacks[character].splice(i,1),matches.push(callback)}return matches}function _eventModifiers(e){var modifiers=[];return e.shiftKey&&modifiers.push("shift"),e.altKey&&modifiers.push("alt"),e.ctrlKey&&modifiers.push("ctrl"),e.metaKey&&modifiers.push("meta"),modifiers}function _preventDefault(e){return e.preventDefault?void e.preventDefault():void(e.returnValue=!1)}function _stopPropagation(e){return e.stopPropagation?void e.stopPropagation():void(e.cancelBubble=!0)}function _fireCallback(callback,e,combo,sequence){Mousetrap.stopCallback(e,e.target||e.srcElement,combo,sequence)||callback(e,combo)===!1&&(_preventDefault(e),_stopPropagation(e))}function _handleKey(character,modifiers,e){var i,callbacks=_getMatches(character,modifiers,e),doNotReset={},maxLevel=0,processedSequenceCallback=!1;for(i=0;i<callbacks.length;++i)callbacks[i].seq&&(maxLevel=Math.max(maxLevel,callbacks[i].level));for(i=0;i<callbacks.length;++i)if(callbacks[i].seq){if(callbacks[i].level!=maxLevel)continue;processedSequenceCallback=!0,doNotReset[callbacks[i].seq]=1,_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq)}else processedSequenceCallback||_fireCallback(callbacks[i].callback,e,callbacks[i].combo);var ignoreThisKeypress="keypress"==e.type&&_ignoreNextKeypress;e.type!=_nextExpectedAction||_isModifier(character)||ignoreThisKeypress||_resetSequences(doNotReset),_ignoreNextKeypress=processedSequenceCallback&&"keydown"==e.type}function _handleKeyEvent(e){"number"!=typeof e.which&&(e.which=e.keyCode);var character=_characterFromEvent(e);if(character)return"keyup"==e.type&&_ignoreNextKeyup===character?void(_ignoreNextKeyup=!1):void Mousetrap.handleKey(character,_eventModifiers(e),e)}function _isModifier(key){return"shift"==key||"ctrl"==key||"alt"==key||"meta"==key}function _resetSequenceTimer(){clearTimeout(_resetTimer),_resetTimer=setTimeout(_resetSequences,1e3)}function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP)key>95&&112>key||_MAP.hasOwnProperty(key)&&(_REVERSE_MAP[_MAP[key]]=key)}return _REVERSE_MAP}function _pickBestAction(key,modifiers,action){return action||(action=_getReverseMap()[key]?"keydown":"keypress"),"keypress"==action&&modifiers.length&&(action="keydown"),action}function _bindSequence(combo,keys,callback,action){function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction,++_sequenceLevels[combo],_resetSequenceTimer()}}function _callbackAndReset(e){_fireCallback(callback,e,combo),"keyup"!==action&&(_ignoreNextKeyup=_characterFromEvent(e)),setTimeout(_resetSequences,10)}_sequenceLevels[combo]=0;for(var i=0;i<keys.length;++i){var isFinal=i+1===keys.length,wrappedCallback=isFinal?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _keysFromString(combination){return"+"===combination?["+"]:combination.split("+")}function _getKeyInfo(combination,action){var keys,key,i,modifiers=[];for(keys=_keysFromString(combination),i=0;i<keys.length;++i)key=keys[i],_SPECIAL_ALIASES[key]&&(key=_SPECIAL_ALIASES[key]),action&&"keypress"!=action&&_SHIFT_MAP[key]&&(key=_SHIFT_MAP[key],modifiers.push("shift")),_isModifier(key)&&modifiers.push(key);return action=_pickBestAction(key,modifiers,action),{key:key,modifiers:modifiers,action:action}}function _bindSingle(combination,callback,action,sequenceName,level){_directMap[combination+":"+action]=callback,combination=combination.replace(/\s+/g," ");var info,sequence=combination.split(" ");return sequence.length>1?void _bindSequence(combination,sequence,callback,action):(info=_getKeyInfo(combination,action),_callbacks[info.key]=_callbacks[info.key]||[],_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level),void _callbacks[info.key][sequenceName?"unshift":"push"]({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination}))}function _bindMultiple(combinations,callback,action){for(var i=0;i<combinations.length;++i)_bindSingle(combinations[i],callback,action)}for(var _REVERSE_MAP,_resetTimer,_MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},_callbacks={},_directMap={},_sequenceLevels={},_ignoreNextKeyup=!1,_ignoreNextKeypress=!1,_nextExpectedAction=!1,i=1;20>i;++i)_MAP[111+i]="f"+i;for(i=0;9>=i;++i)_MAP[i+96]=i;_addEvent(document,"keypress",_handleKeyEvent),_addEvent(document,"keydown",_handleKeyEvent),_addEvent(document,"keyup",_handleKeyEvent);var Mousetrap={bind:function(keys,callback,action){return keys=keys instanceof Array?keys:[keys],_bindMultiple(keys,callback,action),this},unbind:function(keys,action){return Mousetrap.bind(keys,function(){},action)},trigger:function(keys,action){return _directMap[keys+":"+action]&&_directMap[keys+":"+action]({},keys),this},reset:function(){return _callbacks={},_directMap={},this},stopCallback:function(e,element){return(" "+element.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==element.tagName||"SELECT"==element.tagName||"TEXTAREA"==element.tagName||element.isContentEditable},handleKey:_handleKey};window.Mousetrap=Mousetrap,"function"==typeof define&&define.amd&&define(Mousetrap)}(window,document),angular.module("core").controller(["gettext",function(gettext){gettext("No Signal"),gettext("Signal OK"),gettext("Personal Details"),gettext("Gender"),gettext("Male"),gettext("Female"),gettext("Nationality"),gettext("Afghan"),gettext("Albanian"),gettext("Algerian"),gettext("American"),gettext("Andorran"),gettext("Angolan"),gettext("Antiguans"),gettext("Argentinean"),gettext("Armenian"),gettext("Australian"),gettext("Austrian"),gettext("Azerbaijani"),gettext("Bahamian"),gettext("Bahraini"),gettext("Bangladeshi"),gettext("Barbadian"),gettext("Barbudans"),gettext("Batswana"),gettext("Belarusian"),gettext("Belgian"),gettext("Belizean"),gettext("Beninese"),gettext("Bhutanese"),gettext("Bolivian"),gettext("Bosnian"),gettext("Brazilian"),gettext("British"),gettext("Bruneian"),gettext("Bulgarian"),gettext("Burkinabe"),gettext("Burmese"),gettext("Burundian"),gettext("Cambodian"),gettext("Cameroonian"),gettext("Canadian"),gettext("Cape Verdean"),gettext("Central African"),gettext("Chadian"),gettext("Chilean"),gettext("Chinese"),gettext("Colombian"),gettext("Comoran"),gettext("Congolese"),gettext("Costa Rican"),gettext("Croatian"),gettext("Cuban"),gettext("Cypriot"),gettext("Czech"),gettext("Danish"),gettext("Djibouti"),gettext("Dominican"),gettext("Dutch"),gettext("East Timorese"),gettext("Ecuadorean"),gettext("Egyptian"),gettext("Emirian"),gettext("Equatorial Guinean"),gettext("Eritrean"),gettext("Estonian"),gettext("Ethiopian"),gettext("Fijian"),gettext("Filipino"),gettext("Finnish"),gettext("French"),gettext("Gabonese"),gettext("Gambian"),gettext("Georgian"),gettext("German"),gettext("Ghanaian"),gettext("Greek"),gettext("Grenadian"),gettext("Guatemalan"),gettext("Guinea-Bissauan"),gettext("Guinean"),gettext("Guyanese"),gettext("Haitian"),gettext("Herzegovinian"),gettext("Honduran"),gettext("Hungarian"),gettext("I-Kiribati"),gettext("Icelander"),gettext("Indian"),gettext("Indonesian"),gettext("Iranian"),gettext("Iraqi"),gettext("Irish"),gettext("Israeli"),gettext("Italian"),gettext("Ivorian"),gettext("Jamaican"),gettext("Japanese"),gettext("Jordanian"),gettext("Kazakhstani"),gettext("Kenyan"),gettext("Kittian and Nevisian"),gettext("Kuwaiti"),gettext("Kyrgyz"),gettext("Laotian"),gettext("Latvian"),gettext("Lebanese"),gettext("Liberian"),gettext("Libyan"),gettext("Liechtensteiner"),gettext("Lithuanian"),gettext("Luxembourger"),gettext("Macedonian"),gettext("Malagasy"),gettext("Malawian"),gettext("Malaysian"),gettext("Maldivan"),gettext("Malian"),gettext("Maltese"),gettext("Marshallese"),gettext("Mauritanian"),gettext("Mauritian"),gettext("Mexican"),gettext("Micronesian"),gettext("Moldovan"),gettext("Monacan"),gettext("Mongolian"),gettext("Moroccan"),gettext("Mosotho"),gettext("Motswana"),gettext("Mozambican"),gettext("Namibian"),gettext("Nauruan"),gettext("Nepalese"),gettext("New Zealander"),gettext("Nicaraguan"),gettext("Nigerian"),gettext("Nigerien"),gettext("North Korean"),gettext("Northern Irish"),gettext("Norwegian"),gettext("Omani"),gettext("Pakistani"),gettext("Palauan"),gettext("Panamanian"),gettext("Papua New Guinean"),gettext("Paraguayan"),gettext("Peruvian"),gettext("Polish"),gettext("Portuguese"),gettext("Qatari"),gettext("Romanian"),gettext("Russian"),gettext("Rwandan"),gettext("Saint Lucian"),gettext("Salvadoran"),gettext("Samoan"),gettext("San Marinese"),gettext("Sao Tomean"),gettext("Saudi"),gettext("Scottish"),gettext("Senegalese"),gettext("Serbian"),gettext("Seychellois"),gettext("Sierra Leonean"),gettext("Singaporean"),gettext("Slovakian"),gettext("Slovenian"),gettext("Solomon Islander"),gettext("Somali"),gettext("South African"),gettext("South Korean"),gettext("Spanish"),gettext("Sri Lankan"),gettext("Sudanese"),gettext("Surinamer"),gettext("Swazi"),gettext("Swedish"),gettext("Swiss"),gettext("Syrian"),gettext("Taiwanese"),gettext("Tajik"),gettext("Tanzanian"),gettext("Thai"),gettext("Togolese"),gettext("Tongan"),gettext("Trinidadian or Tobagonian"),gettext("Tunisian"),gettext("Turkish"),gettext("Tuvaluan"),gettext("Ugandan"),gettext("Ukrainian"),gettext("Uruguayan"),gettext("Uzbekistani"),gettext("Venezuelan"),gettext("Vietnamese"),gettext("Welsh"),gettext("Yemenite"),gettext("Zambian"),gettext("Zimbabwean"),gettext("Birth Year"),gettext("Musical Background"),gettext("Do you consider yourself a musician or to have specialist musical knowledge?"),gettext("Yes"),gettext("No"),gettext("No expertise whatsoever"),gettext("An expert"),gettext("Do you have any visual impairments? (If so, you may still participate in the experiment!)"),gettext("Select all of the following styles to which you regularly listen:"),gettext("Rock"),gettext("Pop"),gettext("Classical"),gettext("Jazz"),gettext("Dance"),gettext("HipHop"),gettext("Folk"),gettext("World"),gettext("None"),gettext("Media Questions"),gettext("I was engaged with it and responding to it emotionally"),gettext("How involved and engaged were you with what you have just heard?"),gettext("Very negative"),gettext("Very positive"),gettext("How positive or negative did what you have just heard make you feel?"),gettext("Very drowsy"),gettext("Very lively"),gettext("How active or passive did what you have just heard make you feel?"),gettext("Weak<br />(without control, submissive)"),gettext("Empowered<br />(in control of everything, dominant)"),gettext("How in control did you feel?"),gettext("Not at all engaged, my mind was elsewhere"),gettext("Very drowsy"),gettext("Very lively"),gettext("Weak<br />(without control, submissive)"),gettext("Empowered<br />(in control of everything, dominant)"),gettext("How in control did you feel?"),gettext("Not at all"),gettext("Very tense"),gettext("Very relaxed"),gettext("How tense or relaxed did you feel while you were listening?"),gettext("I hated it"),gettext("I loved it"),gettext("How much did you like/dislike what you have just heard?"),gettext("I had never heard it before"),gettext("I listen to it regularly"),gettext("How familiar are you with what you have just heard?"),gettext("Age"),gettext("How would you rate your musical expertise?"),gettext("Do you have any hearing impairments? (If so, you may still participate in the experiment!)"),gettext("Additional Questions"),gettext("How well do the following statements describe your personality?"),gettext("I see myself as someone who is reserved."),gettext("Disagree strongly"),gettext("Disagree a little"),gettext("Neither agree nor disagree"),gettext("Agree a little"),gettext("Agree strongly"),gettext("I see myself as someone who is generally trusting."),gettext("I see myself as someone who tends to be lazy."),gettext("I see myself as someone who is relaxed, handles stress well."),gettext("I see myself as someone who has few artistic interests."),gettext("I see myself as someone who is outgoing, sociable."),gettext("I see myself as someone who tends to find fault with others."),gettext("I see myself as someone who does a thorough job."),gettext("I see myself as someone who gets nervous easily."),gettext("I see myself as someone who has an active imagination."),gettext("This questionnaire uses some simple scales to find out how you responded to the media excerpt. We will compare your responses to the biosignals that we measured as you were listening."),gettext("Final Questions"),gettext("How concentrated were you during this experiment?"),gettext("Very distracted"),gettext("Very concentrated"),gettext("1"),gettext("2"),gettext("3"),gettext("4"),gettext("5"),gettext("6"),gettext("7"),gettext("8"),gettext("9"),gettext("10"),gettext("11"),gettext("12"),gettext("13"),gettext("14"),gettext("15"),gettext("16"),gettext("17"),gettext("18"),gettext("19"),gettext("20"),gettext("21"),gettext("22"),gettext("23"),gettext("24"),gettext("25"),gettext("26"),gettext("27"),gettext("28"),gettext("29"),gettext("30"),gettext("31"),gettext("32"),gettext("33"),gettext("34"),gettext("35"),gettext("36"),gettext("37"),gettext("38"),gettext("39"),gettext("40"),gettext("41"),gettext("42"),gettext("43"),gettext("44"),gettext("45"),gettext("46"),gettext("47"),gettext("48"),gettext("49"),gettext("50"),gettext("51"),gettext("52"),gettext("53"),gettext("54"),gettext("55"),gettext("56"),gettext("57"),gettext("58"),gettext("59"),gettext("60"),gettext("61"),gettext("62"),gettext("63"),gettext("64"),gettext("65"),gettext("66"),gettext("67"),gettext("68"),gettext("69"),gettext("70"),gettext("71"),gettext("72"),gettext("73"),gettext("74"),gettext("75"),gettext("76"),gettext("77"),gettext("78"),gettext("79"),gettext("80"),gettext("81"),gettext("82"),gettext("83"),gettext("84"),gettext("85"),gettext("86"),gettext("87"),gettext("88"),gettext("89"),gettext("90"),gettext("91"),gettext("92"),gettext("93"),gettext("94"),gettext("95"),gettext("96"),gettext("97"),gettext("98"),gettext("99"),gettext("100"),gettext("101"),gettext("102"),gettext("103"),gettext("104"),gettext("105"),gettext("106"),gettext("107"),gettext("108"),gettext("109"),gettext("110"),gettext("111"),gettext("112"),gettext("113"),gettext("114"),gettext("115"),gettext("116"),gettext("117"),gettext("118"),gettext("119"),gettext("120"),gettext("121"),gettext("Begin Playback")}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"}).state("start",{url:"/start",templateUrl:"modules/core/views/start.client.view.html"}).state("consent-form",{url:"/consent-form",templateUrl:"modules/core/views/consent-form.client.view.html"}).state("sound-test",{url:"/sound-test",templateUrl:"modules/core/views/sound-test.client.view.html"}).state("eda-instructions",{url:"/eda-instructions",templateUrl:"modules/core/views/eda-instructions.client.view.html"}).state("pox-instructions",{url:"/pox-instructions",templateUrl:"modules/core/views/pox-instructions.client.view.html"}).state("signal-test",{url:"/signal-test",templateUrl:"modules/core/views/signal-test.client.view.html"}).state("demographics",{url:"/demographics",templateUrl:"modules/core/views/demographics.client.view.html"}).state("musical-background",{url:"/musical-background",templateUrl:"modules/core/views/musical-background.client.view.html"}).state("media-playback",{url:"/media-playback",templateUrl:"modules/core/views/media-playback.client.view.html"}).state("questionnaire",{url:"/media-questionnaire",templateUrl:"modules/core/views/media-questionnaire.client.view.html"}).state("emotion-index",{url:"/emotion-index",templateUrl:"modules/core/views/emotion-index.client.view.html"}).state("thank-you",{url:"/thank-you",templateUrl:"modules/core/views/thank-you.client.view.html"})}]),angular.module("core").controller("DemographicsController",["$scope","TrialData",function($scope,TrialData){$scope.nationalities=["Afghan","Albanian","Algerian","American","Andorran","Angolan","Antiguans","Argentinean","Armenian","Australian","Austrian","Azerbaijani","Bahamian","Bahraini","Bangladeshi","Barbadian","Barbudans","Batswana","Belarusian","Belgian","Belizean","Beninese","Bhutanese","Bolivian","Bosnian","Brazilian","British","Bruneian","Bulgarian","Burkinabe","Burmese","Burundian","Cambodian","Cameroonian","Canadian","Cape Verdean","Central African","Chadian","Chilean","Chinese","Colombian","Comoran","Congolese","Costa Rican","Croatian","Cuban","Cypriot","Czech","Danish","Djibouti","Dominican","Dutch","East Timorese","Ecuadorean","Egyptian","Emirian","Equatorial Guinean","Eritrean","Estonian","Ethiopian","Fijian","Filipino","Finnish","French","Gabonese","Gambian","Georgian","German","Ghanaian","Greek","Grenadian","Guatemalan","Guinea-Bissauan","Guinean","Guyanese","Haitian","Herzegovinian","Honduran","Hungarian","I-Kiribati","Icelander","Indian","Indonesian","Iranian","Iraqi","Irish","Israeli","Italian","Ivorian","Jamaican","Japanese","Jordanian","Kazakhstani","Kenyan","Kittian and Nevisian","Kuwaiti","Kyrgyz","Laotian","Latvian","Lebanese","Liberian","Libyan","Liechtensteiner","Lithuanian","Luxembourger","Macedonian","Malagasy","Malawian","Malaysian","Maldivan","Malian","Maltese","Marshallese","Mauritanian","Mauritian","Mexican","Micronesian","Moldovan","Monacan","Mongolian","Moroccan","Mosotho","Motswana","Mozambican","Namibian","Nauruan","Nepalese","New Zealander","Nicaraguan","Nigerian","Nigerien","North Korean","Northern Irish","Norwegian","Omani","Pakistani","Palauan","Panamanian","Papua New Guinean","Paraguayan","Peruvian","Polish","Portuguese","Qatari","Romanian","Russian","Rwandan","SaintLucian","Salvadoran","Samoan","San Marinese","Sao Tomean","Saudi","Scottish","Senegalese","Serbian","Seychellois","Sierra Leonean","Singaporean","Slovakian","Slovenian","Solomon Islander","Somali","South African","South Korean","Spanish","Sri Lankan","Sudanese","Surinamer","Swazi","Swedish","Swiss","Syrian","Taiwanese","Tajik","Tanzanian","Thai","Togolese","Tongan","Trinidadian or Tobagonian","Tunisian","Turkish","Tuvaluan","Ugandan","Ukrainian","Uruguayan","Uzbekistani","Venezuelan","Vietnamese","Welsh","Yemenite","Zambian","Zimbabwean"],$scope.years=[];for(var thisYear=(new Date).getFullYear(),i=thisYear;i>=thisYear-110;i--)$scope.years.push(i);$scope.nationalityChanged=function(nationality){TrialData.data.answers.nationality=nationality.toLowerCase()},$scope.yearChanged=function(year){TrialData.data.answers.dob=year},$scope.genderChanged=function(gender){TrialData.data.answers.sex=gender}}]),angular.module("core").controller("EmotionIndexController",["$scope","TrialData",function($scope,TrialData){$scope.emotionIndices=TrialData.data.answers.emotion_indices}]),angular.module("core").controller("HomeController",["ExperimentManager","$scope",function(ExperimentManager,$scope){ExperimentManager.masterReset().then(function(){$scope.readyToAdvance=!0},function(){throw $scope.addGenericErrorAlert(),new Error("An experiment schema could not be fetched from the server")}),$scope.readyToAdvance=!1}]),angular.module("core").controller("LastScreenController",["$scope","TrialData","$http",function($scope,TrialData,$http){$http.post("/api/trials",TrialData.data).success(function(){console.log("success")}).error(function(){console.log("error")})}]),angular.module("core").controller("MasterController",["$scope","TrialData","hotkeys","ExperimentManager","gettextCatalog","$state","$timeout",function($scope,TrialData,hotkeys,ExperimentManager,gettextCatalog,$state,$timeout){var thisController=this;$scope.trialDataJson=function(){return TrialData.toJson()},$scope.setLanguage=function(language){gettextCatalog.setCurrentLanguage(language),TrialData.language(language)},this.startOver=function(){$state.go("home",{},{reload:!0})},this.resetInactivityTimeout=function(){$timeout.cancel(thisController.inactivityTimeout),thisController.inactivityTimeout=$timeout(thisController.startOver,3e5)},this.resetInactivityTimeout(),$scope.advanceSlide=function(){thisController.resetInactivityTimeout(),ExperimentManager.advanceSlide()},$scope.debugMode=!1,$scope.toggleDebugMode=function(){$scope.debugMode=!$scope.debugMode;var alertMessage="Debug mode has been ";alertMessage+=$scope.debugMode?"enabled.":"disabled.",$scope.addAlert({type:"info",msg:alertMessage})},hotkeys.add({combo:"d d",description:"Toggle debug mode",callback:$scope.toggleDebugMode}),hotkeys.add({combo:"right",description:"Advance slide",callback:$scope.advanceSlide}),$scope.alerts=[],$scope.addAlert=function(alert){for(var errorExists=!1,i=0;i<$scope.alerts.length;i++)if($scope.alerts[i].msg===alert.msg&&$scope.alerts[i].type===alert.type){errorExists=!0;break}errorExists||$scope.alerts.push(alert)},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.addGenericErrorAlert=function(){$scope.addAlert({type:"danger",msg:"There seems to be a problem. Please contact a mediator for assistance."})},$scope.blackoutClass=!1,$scope.hideBody=function(){$scope.blackoutClass=!0},$scope.showBody=function(){$scope.blackoutClass=!1},$scope.toggleBodyVisibility=function(){$scope.blackoutClass=!$scope.blackoutClass}}]),angular.module("core").controller("MediaPlaybackController",["$scope","TrialData","SocketIOService","$timeout","ExperimentManager",function($scope,TrialData,SocketIOService,$timeout,ExperimentManager){var thisController=this;$scope.currentButtonLabel="Begin Playback",$scope.mediaHasPlayed=!1,$scope.buttonDisabled=!1,$scope.startMediaPlayback=function(){var mediaIndex=TrialData.data.state.mediaPlayCount,mediaLabel=TrialData.data.media[mediaIndex].label;SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/mediaID",args:[{type:"string",value:""+mediaLabel},{type:"string",value:""+TrialData.data.metadata.session_number}]}),$scope.buttonAction=ExperimentManager.advanceSlide},$scope.buttonAction=$scope.startMediaPlayback,this.requestEmotionIndex=function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/emotionIndex",args:[{type:"string",value:""+TrialData.data.metadata.session_number}]})},this.oscMessageReceivedListener=function(data){if("/eim/status/playback"===data.address)1===parseInt(data.args[0].value)?$scope.hideBody():0===parseInt(data.args[0].value)&&(thisController.requestEmotionIndex(),$scope.showBody(),$timeout(function(){$scope.$apply(function(){$scope.currentButtonLabel="Continue",$scope.mediaHasPlayed=!0,$scope.buttonDisabled=!0
})}));else if("/eim/status/emotionIndex"===data.address){var emotionIndex=parseInt(data.args[0].value);TrialData.data.state.mediaPlayCount++,TrialData.setValueForPathForCurrentMedia("data.answers.emotion_indices",emotionIndex),$timeout(function(){$scope.$apply(function(){$scope.buttonDisabled=!1,ExperimentManager.advanceSlide()})})}},SocketIOService.on("oscMessageReceived",this.oscMessageReceivedListener),$scope.$on("$destroy",function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/stopMedia",args:{type:"string",value:""+TrialData.data.metadata.session_number}}),SocketIOService.removeListener("oscMessageReceived",thisController.oscMessageReceivedListener),$scope.showBody()})}]),angular.module("core").controller("MusicalBackgroundController",["$scope","TrialData","ExperimentManager",function($scope,TrialData,ExperimentManager){$scope.advanceSlide=ExperimentManager.advanceSlide,$scope.trialData=TrialData,$scope.musicianChanged=function(isMusician){TrialData.data.answers.musical_background="true"===isMusician.toLowerCase()},$scope.hearingImpairmentsChanged=function(hasHearingImpairments){TrialData.data.answers.hearing_impairments="true"===hasHearingImpairments.toLowerCase()},$scope.visualImpairmentsChanged=function(hasVisualImpairments){TrialData.data.answers.visual_impairments="true"===hasVisualImpairments.toLowerCase()},$scope.$watch("musicalExpertise",function(musicalExpertise){TrialData.data.answers.musical_expertise=musicalExpertise}),$scope.stylesChanged=function(){var newStyles=[];for(var prop in $scope.subject.styles)if($scope.subject.styles.hasOwnProperty(prop)){var style=prop.toString();$scope.subject.styles[style]&&newStyles.push(style)}TrialData.data.answers.music_styles=newStyles.sort()},$scope.trialDataJson=function(){return TrialData.toJson()}}]),angular.module("core").controller("QuestionnaireController",["$scope","TrialData",function($scope,TrialData){$scope.questionnaireData=TrialData.data.schema[TrialData.data.state.currentSlideIndex].data}]),angular.module("core").controller("SignalTestController",["$scope","SocketIOService","TrialData","$timeout",function($scope,SocketIOService,TrialData,$timeout){var thisController=this;$scope.edaQuality=0,$scope.poxQuality=0,$scope.testRecordingComplete=!1,$scope.readyToAdvance=function(){return $scope.debugMode?!0:$scope.allSignalsGood()},$scope.allSignalsGood=function(){return $scope.edaQuality&&$scope.poxQuality},$timeout(function(){thisController.sendStopSignalTestMessage(),$timeout(function(){$scope.edaQuality=1,$scope.poxQuality=1},2500)},12500),this.sendStartSignalTestMessage=function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/signalTest",args:[{type:"integer",value:1},{type:"string",value:""+TrialData.data.metadata.session_number}]})},this.sendStopSignalTestMessage=function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/signalTest",args:[{type:"integer",value:0},{type:"string",value:""+TrialData.data.metadata.session_number}]})},this.oscMessageReceivedListener=function(data){"/eim/status/signalQuality/eda"===data.address?$scope.$apply(function(){$scope.edaQuality=data.args[0].value}):"/eim/status/signalQuality/pox"===data.address?$scope.$apply(function(){$scope.poxQuality=data.args[0].value}):"/eim/status/testRecordingComplete"===data.address&&($scope.$apply(function(){$scope.testRecordingComplete=!0}),this.sendStopSignalTestMessage())},SocketIOService.on("oscMessageReceived",this.oscMessageReceivedListener);var controller=this;$scope.$on("$destroy",function(){SocketIOService.removeListener("oscMessageReceived",controller.oscMessageReceivedListener),controller.sendStopSignalTestMessage()}),this.sendStartSignalTestMessage()}]),angular.module("core").controller("SoundTestController",["$scope","SocketIOService","TrialData","gettextCatalog",function($scope,SocketIOService,TrialData,gettextCatalog){var currentLanguage=gettextCatalog.currentLanguage;SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/soundTest",args:[{type:"integer",value:1},{type:"string",value:currentLanguage},{type:"string",value:""+TrialData.data.metadata.session_number}]}),$scope.stopSoundTest=function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/soundTest",args:[{type:"integer",value:0},{type:"string",value:""+TrialData.data.metadata.session_number}]})},$scope.destroyed=!1,$scope.$on("$destroy",function(){$scope.stopSoundTest()})}]),angular.module("core").controller("StartController",["$scope","$timeout","TrialData","ExperimentManager","SocketIOService",function($scope,$timeout,TrialData,ExperimentManager,SocketIOService){$scope.readyToAdvance=function(){return $scope.maxReady||$scope.debugMode};var now=new Date;TrialData.data.date=now.toISOString(),this.oscMessageReceivedListener=function(data){"/eim/status/startExperiment"===data.address&&$scope.$apply(function(){$scope.maxReady=!0})},SocketIOService.on("oscMessageReceived",this.oscMessageReceivedListener);var thisController=this;$scope.$on("$destroy",function(){SocketIOService.removeListener("oscMessageReceived",thisController.oscMessageReceivedListener),$timeout.cancel(thisController.errorTimeout)}),this.sendExperimentStartMessage=function(){$scope.maxReady=!1,SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/startExperiment",args:{type:"string",value:""+TrialData.data.metadata.session_number}})},this.sendExperimentStartMessage(),this.errorTimeout=$timeout(function(){},1e4),this.errorTimeout.then(function(){if(!$scope.readyToAdvance)throw $scope.addGenericErrorAlert(),new Error("Max had not responded to startExperiment message after 10 seconds")})}]),angular.module("core").directive("checkboxQuestion",["$compile","TrialData",function($compile,TrialData){return{restrict:"E",scope:{},link:function(scope,element,attrs){scope.someSelected=!1,scope.sendToTrialData=function(path,value){attrs.associatedToMedia?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)},scope.updateCheckboxes=function(){for(var newSomeSelectedValue=!1,checkedOptions=[],inputs=element.find("input"),i=0;i<inputs.length;i++){var input=angular.element(inputs[i]);input.attr("name")===attrs.questionId+"Checkbox"&&input.prop("checked")===!0&&(newSomeSelectedValue=!0,checkedOptions.push(input.attr("value").toLowerCase()))}scope.someSelected=newSomeSelectedValue,checkedOptions.sort(),scope.sendToTrialData(attrs.controllerDataPath,checkedOptions)};var questionText='<div class="row well"><div class="col-md-12"><label for="'+attrs.questionId+'Checkbox" translate>'+attrs.questionLabel+"</label><div>",innerQuestionText="";if(element.data("checkboxOptions"))for(var i=0;i<element.data("checkboxOptions").length;i++){var thisOption=element.data("checkboxOptions")[i];innerQuestionText+='<label class="checkbox-inline">',innerQuestionText+='<input type="checkbox" name="'+attrs.questionId+'Checkbox" id="'+attrs.questionId+"Checkbox"+thisOption+'" value="'+thisOption+'" ng-model="'+attrs.questionId+"Checkbox"+thisOption+'" ng-change="updateCheckboxes()"',attrs.questionRequired&&(innerQuestionText+='ng-required="!someSelected"'),innerQuestionText+=">{{'"+thisOption+"' | translate}}</input>",innerQuestionText+="</label>"}questionText+=innerQuestionText+"</div></div></div>";var questionElement=angular.element(questionText);element.append(questionElement),$compile(element.contents())(scope)}}}]),angular.module("core").directive("displayTrialData",function(){return{restrict:"AE",template:'<div class="row trial-data-row"><div class="col-md-12"><h3>Trial Data</h3><pre>{{trialDataJson()}}</pre></div></div>'}}),angular.module("core").directive("dropdownQuestion",["$compile","TrialData",function($compile,TrialData){return{restrict:"E",scope:{},link:function(scope,element,attrs){scope.sendToTrialData=function(path,value){attrs.associatedToMedia?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)},scope[attrs.questionId+"Select"]=null,scope.validSelection=function(){console.log(scope[attrs.questionId+"Select"])},scope.$watch(attrs.questionId+"Select",function(newValue){scope.sendToTrialData(attrs.controllerDataPath,newValue)});var rowDiv=angular.element('<div class="row well"></div>'),formDiv=angular.element('<div class="col-md-12 form-group"></div>');rowDiv.append(formDiv);var label=angular.element('<label class="control-label" translate>'+attrs.questionLabel+"</label>");label.prop("for",attrs.questionId),formDiv.append(label);var select=angular.element('<select class="form-control" ng-valid="validSelection" required></select>');if(select.attr("id",attrs.questionId),select.attr("name",attrs.questionId),select.attr("ng-model",attrs.questionId+"Select"),element.data("dropdownOptions")){scope.dropdownOptions=element.data("dropdownOptions");for(var i in element.data("dropdownOptions")){var optionText=element.data("dropdownOptions")[i],option=angular.element('<option>{{ "'+optionText+'" | translate }}</option>');option.attr("value",optionText),select.append(option)}}formDiv.append(select),element.append(rowDiv),$compile(element.contents())(scope)}}}]),angular.module("core").directive("questionnaire",["$compile",function($compile){var buildScaleQuestion=function(item){var questionElement=angular.element("<scale-question></scale-question>");return item.questionId&&questionElement.attr("question-id",item.questionId),item.questionLabel&&questionElement.attr("question-label",item.questionLabel),item.questionLabelType&&questionElement.attr("label-type",item.questionLabelType),item.questionLikertMinimumDescription&&questionElement.attr("minimum-description",item.questionLikertMinimumDescription),item.questionLikertMaximumDescription&&questionElement.attr("maximum-description",item.questionLikertMaximumDescription),item.questionLikertSingleImageSrc&&questionElement.attr("single-img-src",item.questionLikertSingleImageSrc),item.questionLikertLeftImageSrc&&questionElement.attr("left-img-src",item.questionLikertLeftImageSrc),item.questionLikertRightImageSrc&&questionElement.attr("right-img-src",item.questionLikertRightImageSrc),item.questionStoragePath&&questionElement.attr("controller-data-path",item.questionStoragePath),item.questionIsAssociatedToMedia&&questionElement.attr("associated-to-media",item.questionIsAssociatedToMedia),item.questionOptions&&questionElement.data("questionOptions",item.questionOptions),questionElement},buildRadioQuestion=function(item){var questionElement=angular.element("<radio-question></radio-question>");return item.questionId&&questionElement.attr("question-id",item.questionId),item.questionLabel&&questionElement.attr("question-label",item.questionLabel),item.questionStoragePath&&questionElement.attr("controller-data-path",item.questionStoragePath),item.questionIsAssociatedToMedia&&questionElement.attr("associated-to-media",item.questionIsAssociatedToMedia),item.questionRadioOptions&&questionElement.data("radioOptions",item.questionRadioOptions),questionElement},buildDropdownQuestion=function(item){var questionElement=angular.element("<dropdown-question></dropdown-question>");return item.questionId&&questionElement.attr("question-id",item.questionId),item.questionLabel&&questionElement.attr("question-label",item.questionLabel),item.questionIsAssociatedToMedia&&questionElement.attr("associated-to-media",item.questionIsAssociatedToMedia),item.questionStoragePath&&questionElement.attr("controller-data-path",item.questionStoragePath),item.questionDropdownOptions&&questionElement.data("dropdownOptions",item.questionDropdownOptions),questionElement},buildCheckboxQuestion=function(item){var questionElement=angular.element("<checkbox-question></checkbox-question>");return item.questionId&&questionElement.attr("question-id",item.questionId),item.questionLabel&&questionElement.attr("question-label",item.questionLabel),item.questionIsAssociatedToMedia&&questionElement.attr("associated-to-media",item.questionIsAssociatedToMedia),item.questionStoragePath&&questionElement.attr("controller-data-path",item.questionStoragePath),item.questionCheckboxOptions&&questionElement.data("checkboxOptions",item.questionCheckboxOptions),item.hasOwnProperty("questionRequired")&&item.questionRequired!==!0||questionElement.attr("question-required","true"),questionElement};return{restrict:"E",scope:{questionnaireData:"=",questionnaireForm:"="},link:function(scope,element){var data=scope.questionnaireData;if(data.title){var title=angular.element("<h1 translate>"+data.title+"</h1>");element.append(title)}if(data.introductoryText){var introductoryText=angular.element('<div class="row"><div class="col-md-12 introductory-text"><h2 translate>'+data.introductoryText+"</h2></div></div>");element.append(introductoryText)}var formElement=angular.element('<form class="form" name="questionnaireForm" novalidate></form>');element.append(formElement);for(var i=0;i<data.structure.length;i++){var questionElement,item=data.structure[i];switch(item.questionType){case"likert":questionElement=buildScaleQuestion(item);break;case"radio":questionElement=buildRadioQuestion(item);break;case"dropdown":questionElement=buildDropdownQuestion(item);break;case"checkbox":questionElement=buildCheckboxQuestion(item)}var spacerElement=angular.element('<div class="row"><div class="col-md-12 questionSpacer"></div></div>');formElement.append(questionElement),formElement.append(spacerElement)}$compile(element.contents())(scope)}}}]),angular.module("core").directive("radioQuestion",["$compile","TrialData",function($compile,TrialData){return{restrict:"E",scope:{},link:function(scope,element,attrs){scope.sendToTrialData=function(path,value){attrs.associatedToMedia?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)},scope[attrs.questionId+"RadioGroup"]=null,scope.$watch(attrs.questionId+"RadioGroup",function(newValue){"true"===newValue?newValue=!0:"false"===newValue&&(newValue=!1),scope.sendToTrialData(attrs.controllerDataPath,newValue)});var questionText='<div class="row"><div class="col-md-12"><label for="'+attrs.questionId+'Radio" translate>'+attrs.questionLabel+"</label><div>",innerQuestionText="";if(element.data("radioOptions"))for(var i=0;i<element.data("radioOptions").length;i++){var thisOption=element.data("radioOptions")[i];innerQuestionText+='<label class="radio-inline"><input type="radio" name="'+attrs.questionId+'RadioGroup" id="'+attrs.questionId+"Radio"+thisOption.label+'" value="'+thisOption.value+'" ng-model="'+attrs.questionId+'RadioGroup" required="true">{{\''+thisOption.label+"' | translate}}</input></label>"}questionText+=innerQuestionText+"</div></div></div>";var questionElement=angular.element(questionText);questionElement.addClass("well"),element.append(questionElement),$compile(element.contents())(scope)}}}]),angular.module("core").directive("scaleQuestion",["$compile","TrialData",function($compile,TrialData){var buildDescriptionsRow=function(scope,element,attrs){var descriptions;if(attrs.minimumDescription&&attrs.maximumDescription){descriptions=angular.element("<div></div>"),descriptions.addClass("row"),descriptions.addClass("scale-descriptions");var sideSpacer=angular.element("<div></div>");sideSpacer.addClass("col-md-2");var centerSpacer=angular.element("<div></div>");centerSpacer.addClass("col-md-4");var descriptionsInnerRow=angular.element("<div></div>");descriptionsInnerRow.addClass("col-md-8"),descriptionsInnerRow.addClass("scale-descriptions-inner-row");var fifthsColumnSpacer=angular.element("<div></div>");fifthsColumnSpacer.addClass("col-md-5ths");var leftTextBlock=angular.element("<div translate></div>");leftTextBlock.addClass("col-md-5ths"),leftTextBlock.addClass("small"),leftTextBlock.addClass("text-center"),leftTextBlock.addClass("scale-minimum-description"),leftTextBlock.html(attrs.minimumDescription);var rightTextBlock=leftTextBlock.clone();rightTextBlock.removeClass("scale-minimum-description"),rightTextBlock.addClass("scale-maximum-description"),rightTextBlock.html(attrs.maximumDescription),descriptionsInnerRow.append(leftTextBlock),descriptionsInnerRow.append(fifthsColumnSpacer.clone(),fifthsColumnSpacer.clone(),fifthsColumnSpacer.clone()),descriptionsInnerRow.append(rightTextBlock),descriptions.append(sideSpacer.clone(),descriptionsInnerRow,sideSpacer.clone())}return descriptions};return{restrict:"E",scope:{},link:function(scope,element,attrs){scope.sendToTrialData=function(path,value){attrs.associatedToMedia?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)},scope[attrs.questionId+"RadioGroup"]=null,scope.$watch(attrs.questionId+"RadioGroup",function(newValue){scope.sendToTrialData(attrs.controllerDataPath,parseInt(newValue))});var questionHeader;questionHeader=angular.element("labelLeft"===attrs.labelType?'<div class="row"><div class="col-md-12"><label translate>'+attrs.questionLabel+"</label></div></div>":'<div class="row"><div class="col-md-12 text-center"><h3 translate>'+attrs.questionLabel+"</h3></div></div>");var image;attrs.singleImgSrc?image=angular.element('<div class="row"><div class="col-md-2"></div><div class="col-md-8 text-center"><img src="'+attrs.singleImgSrc+'"></div><div class="col-md-2"></div></div>'):attrs.leftImgSrc&&attrs.rightImgSrc&&(image=angular.element('<div class="row"><div class="col-md-2"></div><div class="col-md-2"><img src="'+attrs.leftImgSrc+'"></div><div class="col-md-4"></div><div class="col-md-2"><img src="'+attrs.rightImgSrc+'"></div><div class="col-md-2"></div></div>'));var optionLabels;if(element.data("questionOptions")&&element.data("questionOptions").choices){var choices=element.data("questionOptions").choices;optionLabels=angular.element('<div class="row"></div>'),optionLabels.append('<div class="col-md-2 option-label-spacer"></div>');for(var centerGroup=angular.element('<div class="col-md-8 option-label-container text-center"></div>'),i=0;i<choices.length;i++){var choiceDiv=angular.element('<div class="col-md-5ths option-label text-center">{{ \''+choices[i].label+"' | translate }}</div>");centerGroup.append(choiceDiv)}optionLabels.append(centerGroup),optionLabels.append('<div class="col-md-2 option-label-spacer"></div>')}for(var innerRadioHTML="",j=1;5>=j;j++)innerRadioHTML+='<div class="col-md-5ths text-center"><input type="radio" name="'+attrs.questionId+'RadioGroup" id="'+attrs.questionId+"RadioGroup"+j+'" value="'+j+'" required ng-model="'+attrs.questionId+'RadioGroup"></div>';var radios=angular.element('<div class="row">\n    <div class="col-md-2"></div>\n    <div class="col-md-8 text-center">\n        '+innerRadioHTML+'<div class="row">\n        </div>\n    </div>\n    <div class="col-md-2"></div>\n</div>'),descriptions=buildDescriptionsRow(scope,element,attrs),wrapperDiv=angular.element('<div class="row well"></div>');wrapperDiv.append(questionHeader,image,optionLabels,radios,descriptions),element.append(wrapperDiv),$compile(element.contents())(scope)}}}]),angular.module("core").directive("sliderScale",["$compile","TrialData",function($compile,TrialData){return{replace:!1,restrict:"E",scope:{},link:function(scope,element,attrs){scope.associated=attrs.associatedToMedia&&"true"===attrs.associatedToMedia.toLowerCase()?!0:!1,scope.sendToTrialData=function(path,value){scope.associated?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)};var sliderElement;switch(attrs.imageType){case"extremes":sliderElement=angular.element('<div class="row"><div class="col-md-2 text-center slider-image"></div><div class="col-md-2 slider-image text-center"><img src="'+attrs.leftImageSrc+'" /></div><!----><div class="col-md-4 slider-image"></div><!----><div class="col-md-2 slider-image text-center"><img src="'+attrs.rightImageSrc+'" /></div><!----><div class="col-md-2 text-center slider-image"></div><div class="clearBoth"></div><div class="col-md-2 text-center slider-image"></div><!----><div class="col-md-8 slider-image"><slider ng-change="sendToTrialData(\''+attrs.controllerDataPath+'\', sliderModel)" ng-model="sliderModel" floor="'+attrs.sliderFloor+'" ceiling="'+attrs.sliderCeiling+'" step="'+attrs.sliderStep+'" stretch="'+attrs.sliderStretch+'" ng-init="sliderModel='+attrs.sliderInitialValue+'"></slider></div><!----><div class="col-md-2 text-center slider-image"></div></div>');break;case"single":sliderElement=angular.element('<div class="row"><div class="col-md-12 slider-image text-center"><img src="'+attrs.singleImageSrc+'" /></div><div class="col-md-2 text-center slider-image"></div><!----><div class="col-md-8 slider-image"><slider ng-change="sendToTrialData(\''+attrs.controllerDataPath+'\', sliderModel)" ng-model="sliderModel" floor="'+attrs.sliderFloor+'" ceiling="'+attrs.sliderCeiling+'" step="'+attrs.sliderStep+'" stretch="'+attrs.sliderStretch+'" ng-init="sliderModel='+attrs.sliderInitialValue+'"></slider></div><!----><div class="col-md-2 text-center slider-image"></div></div>');break;default:sliderElement=angular.element('<div class="row"><div class="col-md-2 text-center slider-image"></div><!----><div class="col-md-8 slider-image"><slider ng-change="sendToTrialData(\''+attrs.controllerDataPath+'\', sliderModel)" ng-model="sliderModel" floor="'+attrs.sliderFloor+'" ceiling="'+attrs.sliderCeiling+'" step="'+attrs.sliderStep+'" stretch="'+attrs.sliderStretch+'" ng-init="sliderModel='+attrs.sliderInitialValue+'"></slider></div><!----><div class="col-md-2 text-center slider-image"></div></div>')}$compile(sliderElement)(scope),element.after(sliderElement),scope.sendToTrialData(attrs.controllerDataPath,attrs.sliderInitialValue)}}}]),angular.module("core").factory("ExperimentManager",["TrialData","$q","$http","$state",function(TrialData,$q,$http,$state){return{advanceSlide:function(){TrialData.data.state.currentSlideIndex++,TrialData.data.state.currentSlideIndex===TrialData.data.schema.length?$state.go("home",{},{reload:!0}):$state.go(TrialData.data.schema[TrialData.data.state.currentSlideIndex].name,{},{reload:!0})},masterReset:function(){var deferred=$q.defer();return TrialData.reset(),TrialData.data.metadata.session_number=UUID.generate(),$http.get("/api/experiment-schemas/random").success(function(data){TrialData.data.media=data.media,TrialData.data.schema=data.structure,deferred.resolve()}).error(function(){deferred.reject("An experiment schema could not be fetched from the server")}),deferred.promise}}}]),angular.module("core").factory("SocketIOService",["socketFactory",function(socketFactory){return socketFactory()}]),angular.module("core").factory("TrialData",[function(){function BlankDataObject(){return{answers:{},date:null,media:[],timestamps:{start:null,test:null,media:[],end:null},metadata:{language:"en",session_number:null,location:"taipei_city",terminal:null},state:{currentSlideIndex:-1,mediaPlayCount:0}}}var trialData={data:null,toJson:function(){return angular.toJson(this.data,!0)},reset:function(){this.data=new BlankDataObject},setValueForPath:function(path,value,options){"true"===value?value=!0:"false"===value&&(value=!1);var numericRegex=/\d+\.?\d?/;if("string"==typeof value&&value.match(numericRegex)&&(value=parseFloat(value)),"string"==typeof value&&(value=value.toLowerCase()),path&&void 0!==value){for(var schema=this,pList=path.split("."),len=pList.length,i=0;len-1>i;i++){var elem=pList[i];schema[elem]||(schema[elem]={}),schema=schema[elem]}if(options&&options.hasOwnProperty("array_index")&&"number"==typeof options.array_index){void 0===schema[pList[len-1]]&&(schema[pList[len-1]]=[]);for(var j=0;j<options.array_index;j++)void 0===schema[pList[len-1]][j]&&(schema[pList[len-1]][j]=null);schema[pList[len-1]][options.array_index]=value}else schema[pList[len-1]]=value}},setValueForPathForCurrentMedia:function(path,value){var index;index=this.data.state.mediaPlayCount<=0?0:this.data.state.mediaPlayCount-1,this.setValueForPath(path,value,{array_index:index})},language:function(newLanguage){return"string"==typeof newLanguage&&(this.data.metadata.language=newLanguage),this.data.metadata.language}};return trialData.data=new BlankDataObject,trialData}]);