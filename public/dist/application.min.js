"use strict";var ApplicationConfiguration=function(){var applicationModuleName="emotion-in-motion",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","vr.directives.slider","cfp.hotkeys","btford.socket-io","gettext"],registerModule=function(moduleName){angular.module(moduleName,[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["gettextCatalog",function(gettextCatalog){gettextCatalog.setCurrentLanguage("en"),gettextCatalog.debug=!0}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope",function($rootScope){$rootScope.$on("$stateChangeSuccess",function(){$("html, body").animate({scrollTop:0},200)})}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),angular.module("core").controller(["gettext",function(gettext){gettext("No Signal"),gettext("Signal OK"),gettext("Personal Details"),gettext("Gender"),gettext("Male"),gettext("Female"),gettext("Nationality"),gettext("Afghan"),gettext("Albanian"),gettext("Algerian"),gettext("American"),gettext("Andorran"),gettext("Angolan"),gettext("Antiguans"),gettext("Argentinean"),gettext("Armenian"),gettext("Australian"),gettext("Austrian"),gettext("Azerbaijani"),gettext("Bahamian"),gettext("Bahraini"),gettext("Bangladeshi"),gettext("Barbadian"),gettext("Barbudans"),gettext("Batswana"),gettext("Belarusian"),gettext("Belgian"),gettext("Belizean"),gettext("Beninese"),gettext("Bhutanese"),gettext("Bolivian"),gettext("Bosnian"),gettext("Brazilian"),gettext("British"),gettext("Bruneian"),gettext("Bulgarian"),gettext("Burkinabe"),gettext("Burmese"),gettext("Burundian"),gettext("Cambodian"),gettext("Cameroonian"),gettext("Canadian"),gettext("Cape Verdean"),gettext("Central African"),gettext("Chadian"),gettext("Chilean"),gettext("Chinese"),gettext("Colombian"),gettext("Comoran"),gettext("Congolese"),gettext("Costa Rican"),gettext("Croatian"),gettext("Cuban"),gettext("Cypriot"),gettext("Czech"),gettext("Danish"),gettext("Djibouti"),gettext("Dominican"),gettext("Dutch"),gettext("East Timorese"),gettext("Ecuadorean"),gettext("Egyptian"),gettext("Emirian"),gettext("Equatorial Guinean"),gettext("Eritrean"),gettext("Estonian"),gettext("Ethiopian"),gettext("Fijian"),gettext("Filipino"),gettext("Finnish"),gettext("French"),gettext("Gabonese"),gettext("Gambian"),gettext("Georgian"),gettext("German"),gettext("Ghanaian"),gettext("Greek"),gettext("Grenadian"),gettext("Guatemalan"),gettext("Guinea-Bissauan"),gettext("Guinean"),gettext("Guyanese"),gettext("Haitian"),gettext("Herzegovinian"),gettext("Honduran"),gettext("Hungarian"),gettext("I-Kiribati"),gettext("Icelander"),gettext("Indian"),gettext("Indonesian"),gettext("Iranian"),gettext("Iraqi"),gettext("Irish"),gettext("Israeli"),gettext("Italian"),gettext("Ivorian"),gettext("Jamaican"),gettext("Japanese"),gettext("Jordanian"),gettext("Kazakhstani"),gettext("Kenyan"),gettext("Kittian and Nevisian"),gettext("Kuwaiti"),gettext("Kyrgyz"),gettext("Laotian"),gettext("Latvian"),gettext("Lebanese"),gettext("Liberian"),gettext("Libyan"),gettext("Liechtensteiner"),gettext("Lithuanian"),gettext("Luxembourger"),gettext("Macedonian"),gettext("Malagasy"),gettext("Malawian"),gettext("Malaysian"),gettext("Maldivan"),gettext("Malian"),gettext("Maltese"),gettext("Marshallese"),gettext("Mauritanian"),gettext("Mauritian"),gettext("Mexican"),gettext("Micronesian"),gettext("Moldovan"),gettext("Monacan"),gettext("Mongolian"),gettext("Moroccan"),gettext("Mosotho"),gettext("Motswana"),gettext("Mozambican"),gettext("Namibian"),gettext("Nauruan"),gettext("Nepalese"),gettext("New Zealander"),gettext("Nicaraguan"),gettext("Nigerian"),gettext("Nigerien"),gettext("North Korean"),gettext("Northern Irish"),gettext("Norwegian"),gettext("Omani"),gettext("Pakistani"),gettext("Palauan"),gettext("Panamanian"),gettext("Papua New Guinean"),gettext("Paraguayan"),gettext("Peruvian"),gettext("Polish"),gettext("Portuguese"),gettext("Qatari"),gettext("Romanian"),gettext("Russian"),gettext("Rwandan"),gettext("Saint Lucian"),gettext("Salvadoran"),gettext("Samoan"),gettext("San Marinese"),gettext("Sao Tomean"),gettext("Saudi"),gettext("Scottish"),gettext("Senegalese"),gettext("Serbian"),gettext("Seychellois"),gettext("Sierra Leonean"),gettext("Singaporean"),gettext("Slovakian"),gettext("Slovenian"),gettext("Solomon Islander"),gettext("Somali"),gettext("South African"),gettext("South Korean"),gettext("Spanish"),gettext("Sri Lankan"),gettext("Sudanese"),gettext("Surinamer"),gettext("Swazi"),gettext("Swedish"),gettext("Swiss"),gettext("Syrian"),gettext("Taiwanese"),gettext("Tajik"),gettext("Tanzanian"),gettext("Thai"),gettext("Togolese"),gettext("Tongan"),gettext("Trinidadian or Tobagonian"),gettext("Tunisian"),gettext("Turkish"),gettext("Tuvaluan"),gettext("Ugandan"),gettext("Ukrainian"),gettext("Uruguayan"),gettext("Uzbekistani"),gettext("Venezuelan"),gettext("Vietnamese"),gettext("Welsh"),gettext("Yemenite"),gettext("Zambian"),gettext("Zimbabwean"),gettext("Birth Year"),gettext("Musical Background"),gettext("Do you consider yourself a musician or to have specialist musical knowledge?"),gettext("Yes"),gettext("No"),gettext("No expertise whatsoever"),gettext("An expert"),gettext("Do you have any visual impairments? (If so, you may still participate in the experiment!)"),gettext("Select all of the following styles to which you regularly listen:"),gettext("Rock"),gettext("Pop"),gettext("Classical"),gettext("Jazz"),gettext("Dance"),gettext("HipHop"),gettext("Folk"),gettext("World"),gettext("None"),gettext("Media Questions"),gettext("I was engaged with it and responding to it emotionally"),gettext("How involved and engaged were you with what you have just heard?"),gettext("Very negative"),gettext("Very positive"),gettext("How positive or negative did what you have just heard make you feel?"),gettext("Very drowsy"),gettext("Very lively"),gettext("How active or passive did what you have just heard make you feel?"),gettext("Weak (without control, submissive)"),gettext("Empowered (in control of everything, dominant)"),gettext("How in control did you feel?"),gettext("Not at all engaged, my mind was elsewhere"),gettext("Very drowsy"),gettext("Very lively"),gettext("Weak (without control, submissive)"),gettext("Empowered (in control of everything, dominant)"),gettext("How in control did you feel?"),gettext("Not at all"),gettext("Very tense"),gettext("Very relaxed"),gettext("How tense or relaxed did you feel while you were listening?"),gettext("I hated it"),gettext("I loved it"),gettext("How much did you like/dislike what you have just heard?"),gettext("I had never heard it before"),gettext("I listen to it regularly"),gettext("How familiar are you with what you have just heard?"),gettext("Age"),gettext("How would you rate your musical expertise?"),gettext("Do you have any hearing impairments? (If so, you may still participate in the experiment!)"),gettext("Additional Questions"),gettext("How well do the following statements describe your personality?"),gettext("I see myself as someone who is reserved."),gettext("Disagree strongly"),gettext("Disagree a little"),gettext("Neither agree nor disagree"),gettext("Agree a little"),gettext("Agree strongly"),gettext("I see myself as someone who is generally trusting."),gettext("I see myself as someone who tends to be lazy."),gettext("I see myself as someone who is relaxed, handles stress well."),gettext("I see myself as someone who has few artistic interests."),gettext("I see myself as someone who is outgoing, sociable."),gettext("I see myself as someone who tends to find fault with others."),gettext("I see myself as someone who does a thorough job."),gettext("I see myself as someone who gets nervous easily."),gettext("I see myself as someone who has an active imagination."),gettext("This questionnaire uses some simple scales to find out how you responded to the media excerpt. We will compare your responses to the biosignals that we measured as you were listening."),gettext("Final Questions"),gettext("How concentrated were you during this experiment?"),gettext("Very distracted"),gettext("Very concentrated"),gettext("1"),gettext("2"),gettext("3"),gettext("4"),gettext("5"),gettext("6"),gettext("7"),gettext("8"),gettext("9"),gettext("10"),gettext("11"),gettext("12"),gettext("13"),gettext("14"),gettext("15"),gettext("16"),gettext("17"),gettext("18"),gettext("19"),gettext("20"),gettext("21"),gettext("22"),gettext("23"),gettext("24"),gettext("25"),gettext("26"),gettext("27"),gettext("28"),gettext("29"),gettext("30"),gettext("31"),gettext("32"),gettext("33"),gettext("34"),gettext("35"),gettext("36"),gettext("37"),gettext("38"),gettext("39"),gettext("40"),gettext("41"),gettext("42"),gettext("43"),gettext("44"),gettext("45"),gettext("46"),gettext("47"),gettext("48"),gettext("49"),gettext("50"),gettext("51"),gettext("52"),gettext("53"),gettext("54"),gettext("55"),gettext("56"),gettext("57"),gettext("58"),gettext("59"),gettext("60"),gettext("61"),gettext("62"),gettext("63"),gettext("64"),gettext("65"),gettext("66"),gettext("67"),gettext("68"),gettext("69"),gettext("70"),gettext("71"),gettext("72"),gettext("73"),gettext("74"),gettext("75"),gettext("76"),gettext("77"),gettext("78"),gettext("79"),gettext("80"),gettext("81"),gettext("82"),gettext("83"),gettext("84"),gettext("85"),gettext("86"),gettext("87"),gettext("88"),gettext("89"),gettext("90"),gettext("91"),gettext("92"),gettext("93"),gettext("94"),gettext("95"),gettext("96"),gettext("97"),gettext("98"),gettext("99"),gettext("100"),gettext("101"),gettext("102"),gettext("103"),gettext("104"),gettext("105"),gettext("106"),gettext("107"),gettext("108"),gettext("109"),gettext("110"),gettext("111"),gettext("112"),gettext("113"),gettext("114"),gettext("115"),gettext("116"),gettext("117"),gettext("118"),gettext("119"),gettext("120"),gettext("121"),gettext("Begin Playback")}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"}).state("start",{url:"/start",templateUrl:"modules/core/views/start.client.view.html"}).state("consent-form",{url:"/consent-form",templateUrl:"modules/core/views/consent-form.client.view.html"}).state("sound-test",{url:"/sound-test",templateUrl:"modules/core/views/sound-test.client.view.html"}).state("eda-instructions",{url:"/eda-instructions",templateUrl:"modules/core/views/eda-instructions.client.view.html"}).state("pox-instructions",{url:"/pox-instructions",templateUrl:"modules/core/views/pox-instructions.client.view.html"}).state("signal-test",{url:"/signal-test",templateUrl:"modules/core/views/signal-test.client.view.html"}).state("demographics",{url:"/demographics",templateUrl:"modules/core/views/demographics.client.view.html"}).state("musical-background",{url:"/musical-background",templateUrl:"modules/core/views/musical-background.client.view.html"}).state("media-playback",{url:"/media-playback",templateUrl:"modules/core/views/media-playback.client.view.html"}).state("questionnaire",{url:"/media-questionnaire",templateUrl:"modules/core/views/media-questionnaire.client.view.html"}).state("emotion-index",{url:"/emotion-index",templateUrl:"modules/core/views/emotion-index.client.view.html"}).state("thank-you",{url:"/thank-you",templateUrl:"modules/core/views/thank-you.client.view.html"})}]),angular.module("core").controller("DemographicsController",["$scope","TrialData",function($scope,TrialData){$scope.nationalities=["Afghan","Albanian","Algerian","American","Andorran","Angolan","Antiguans","Argentinean","Armenian","Australian","Austrian","Azerbaijani","Bahamian","Bahraini","Bangladeshi","Barbadian","Barbudans","Batswana","Belarusian","Belgian","Belizean","Beninese","Bhutanese","Bolivian","Bosnian","Brazilian","British","Bruneian","Bulgarian","Burkinabe","Burmese","Burundian","Cambodian","Cameroonian","Canadian","Cape Verdean","Central African","Chadian","Chilean","Chinese","Colombian","Comoran","Congolese","Costa Rican","Croatian","Cuban","Cypriot","Czech","Danish","Djibouti","Dominican","Dutch","East Timorese","Ecuadorean","Egyptian","Emirian","Equatorial Guinean","Eritrean","Estonian","Ethiopian","Fijian","Filipino","Finnish","French","Gabonese","Gambian","Georgian","German","Ghanaian","Greek","Grenadian","Guatemalan","Guinea-Bissauan","Guinean","Guyanese","Haitian","Herzegovinian","Honduran","Hungarian","I-Kiribati","Icelander","Indian","Indonesian","Iranian","Iraqi","Irish","Israeli","Italian","Ivorian","Jamaican","Japanese","Jordanian","Kazakhstani","Kenyan","Kittian and Nevisian","Kuwaiti","Kyrgyz","Laotian","Latvian","Lebanese","Liberian","Libyan","Liechtensteiner","Lithuanian","Luxembourger","Macedonian","Malagasy","Malawian","Malaysian","Maldivan","Malian","Maltese","Marshallese","Mauritanian","Mauritian","Mexican","Micronesian","Moldovan","Monacan","Mongolian","Moroccan","Mosotho","Motswana","Mozambican","Namibian","Nauruan","Nepalese","New Zealander","Nicaraguan","Nigerian","Nigerien","North Korean","Northern Irish","Norwegian","Omani","Pakistani","Palauan","Panamanian","Papua New Guinean","Paraguayan","Peruvian","Polish","Portuguese","Qatari","Romanian","Russian","Rwandan","SaintLucian","Salvadoran","Samoan","San Marinese","Sao Tomean","Saudi","Scottish","Senegalese","Serbian","Seychellois","Sierra Leonean","Singaporean","Slovakian","Slovenian","Solomon Islander","Somali","South African","South Korean","Spanish","Sri Lankan","Sudanese","Surinamer","Swazi","Swedish","Swiss","Syrian","Taiwanese","Tajik","Tanzanian","Thai","Togolese","Tongan","Trinidadian or Tobagonian","Tunisian","Turkish","Tuvaluan","Ugandan","Ukrainian","Uruguayan","Uzbekistani","Venezuelan","Vietnamese","Welsh","Yemenite","Zambian","Zimbabwean"],$scope.years=[];for(var thisYear=(new Date).getFullYear(),i=thisYear;i>=thisYear-110;i--)$scope.years.push(i);$scope.nationalityChanged=function(nationality){TrialData.data.answers.nationality=nationality.toLowerCase()},$scope.yearChanged=function(year){TrialData.data.answers.dob=year},$scope.genderChanged=function(gender){TrialData.data.answers.sex=gender}}]),angular.module("core").controller("EmotionIndexController",["$scope","TrialData",function($scope,TrialData){$scope.emotionIndices=TrialData.data.answers.emotion_indices}]),angular.module("core").controller("HomeController",["ExperimentManager","$scope",function(ExperimentManager,$scope){ExperimentManager.masterReset().then(function(){$scope.readyToAdvance=!0},function(){throw $scope.addGenericErrorAlert(),new Error("An experiment schema could not be fetched from the server")}),$scope.readyToAdvance=!1}]),angular.module("core").controller("LastScreenController",["$scope","TrialData","$http",function($scope,TrialData,$http){$http.post("/api/trials",TrialData.data)}]),angular.module("core").controller("MasterController",["$scope","TrialData","hotkeys","ExperimentManager","gettextCatalog","$state","$timeout",function($scope,TrialData,hotkeys,ExperimentManager,gettextCatalog,$state,$timeout){var thisController=this;$scope.trialDataJson=function(){return TrialData.toJson()},$scope.setLanguage=function(language){gettextCatalog.setCurrentLanguage(language),TrialData.language(language)},this.startOver=function(){$state.go("home",{},{reload:!0})},this.resetInactivityTimeout=function(){$timeout.cancel(thisController.inactivityTimeout),thisController.inactivityTimeout=$timeout(thisController.startOver,3e5)},this.resetInactivityTimeout(),$scope.advanceSlide=function(){thisController.resetInactivityTimeout(),ExperimentManager.advanceSlide()},$scope.debugMode=!1,$scope.toggleDebugMode=function(){$scope.debugMode=!$scope.debugMode;var alertMessage="Debug mode has been ";alertMessage+=$scope.debugMode?"enabled.":"disabled.",$scope.addAlert({type:"info",msg:alertMessage})},hotkeys.add({combo:"d d",description:"Toggle debug mode",callback:$scope.toggleDebugMode}),hotkeys.add({combo:"right",description:"Advance slide",callback:$scope.advanceSlide}),$scope.alerts=[],$scope.addAlert=function(alert){for(var errorExists=!1,i=0;i<$scope.alerts.length;i++)if($scope.alerts[i].msg===alert.msg&&$scope.alerts[i].type===alert.type){errorExists=!0;break}errorExists||$scope.alerts.push(alert)},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.addGenericErrorAlert=function(){$scope.addAlert({type:"danger",msg:"There seems to be a problem. Please contact a mediator for assistance."})},$scope.blackoutClass=!1,$scope.hideBody=function(){$scope.blackoutClass=!0},$scope.showBody=function(){$scope.blackoutClass=!1},$scope.toggleBodyVisibility=function(){$scope.blackoutClass=!$scope.blackoutClass}}]),angular.module("core").controller("MediaPlaybackController",["$scope","TrialData","SocketIOService","$timeout","ExperimentManager",function($scope,TrialData,SocketIOService,$timeout,ExperimentManager){var thisController=this;$scope.currentButtonLabel="Begin Playback",$scope.mediaHasPlayed=!1,$scope.buttonDisabled=!1,$scope.startMediaPlayback=function(){var mediaIndex=TrialData.data.state.mediaPlayCount,mediaLabel=TrialData.data.media[mediaIndex].label;SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/mediaID",args:[{type:"string",value:""+mediaLabel},{type:"string",value:""+TrialData.data.metadata.session_number}]}),$scope.buttonAction=ExperimentManager.advanceSlide},$scope.buttonAction=$scope.startMediaPlayback,this.requestEmotionIndex=function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/emotionIndex",args:[{type:"string",value:""+TrialData.data.metadata.session_number}]})},this.oscMessageReceivedListener=function(data){if("/eim/status/playback"===data.address)switch(parseInt(data.args[0].value)){case 0:thisController.requestEmotionIndex(),$scope.showBody(),$timeout(function(){$scope.$apply(function(){$scope.currentButtonLabel="Continue",$scope.mediaHasPlayed=!0,$scope.buttonDisabled=!0})});break;case 1:$scope.hideBody()}if("/eim/status/emotionIndex"===data.address){var emotionIndex=parseInt(data.args[0].value);TrialData.data.state.mediaPlayCount++,TrialData.setValueForPathForCurrentMedia("data.answers.emotion_indices",emotionIndex),$timeout(function(){$scope.$apply(function(){$scope.buttonDisabled=!1,ExperimentManager.advanceSlide()})})}},SocketIOService.on("oscMessageReceived",this.oscMessageReceivedListener),$scope.$on("$destroy",function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/stopMedia",args:{type:"string",value:""+TrialData.data.metadata.session_number}}),SocketIOService.removeListener("oscMessageReceived",thisController.oscMessageReceivedListener),$scope.showBody()})}]),angular.module("core").controller("QuestionnaireController",["$scope","TrialData",function($scope,TrialData){$scope.questionnaireData=TrialData.data.schema[TrialData.data.state.currentSlideIndex].data}]),angular.module("core").controller("SignalTestController",["$scope","SocketIOService","TrialData","$timeout",function($scope,SocketIOService,TrialData,$timeout){var thisController=this;$scope.edaQuality=0,$scope.poxQuality=0,$scope.testRecordingComplete=!1,$scope.readyToAdvance=function(){return $scope.debugMode?!0:$scope.allSignalsGood()},$scope.allSignalsGood=function(){return $scope.edaQuality&&$scope.poxQuality},$timeout(function(){thisController.sendStopSignalTestMessage(),$timeout(function(){$scope.edaQuality=1,$scope.poxQuality=1},2500)},12500),this.sendStartSignalTestMessage=function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/signalTest",args:[{type:"integer",value:1},{type:"string",value:""+TrialData.data.metadata.session_number}]})},this.sendStopSignalTestMessage=function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/signalTest",args:[{type:"integer",value:0},{type:"string",value:""+TrialData.data.metadata.session_number}]})},this.oscMessageReceivedListener=function(data){"/eim/status/signalQuality/eda"===data.address&&$scope.$apply(function(){$scope.edaQuality=data.args[0].value}),"/eim/status/signalQuality/pox"===data.address&&$scope.$apply(function(){$scope.poxQuality=data.args[0].value}),"/eim/status/testRecordingComplete"===data.address&&($scope.$apply(function(){$scope.testRecordingComplete=!0}),this.sendStopSignalTestMessage())},SocketIOService.on("oscMessageReceived",this.oscMessageReceivedListener);var controller=this;$scope.$on("$destroy",function(){SocketIOService.removeListener("oscMessageReceived",controller.oscMessageReceivedListener),controller.sendStopSignalTestMessage()}),this.sendStartSignalTestMessage()}]),angular.module("core").controller("SoundTestController",["$scope","SocketIOService","TrialData","gettextCatalog",function($scope,SocketIOService,TrialData,gettextCatalog){var currentLanguage=gettextCatalog.currentLanguage;SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/soundTest",args:[{type:"integer",value:1},{type:"string",value:currentLanguage},{type:"string",value:""+TrialData.data.metadata.session_number}]}),$scope.stopSoundTest=function(){SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/soundTest",args:[{type:"integer",value:0},{type:"string",value:""+TrialData.data.metadata.session_number}]})},$scope.destroyed=!1,$scope.$on("$destroy",function(){$scope.stopSoundTest()})}]),angular.module("core").controller("StartController",["$scope","$timeout","TrialData","ExperimentManager","SocketIOService",function($scope,$timeout,TrialData,ExperimentManager,SocketIOService){$scope.readyToAdvance=function(){return $scope.maxReady||$scope.debugMode};var now=new Date;TrialData.data.date=now.toISOString(),this.oscMessageReceivedListener=function(data){"/eim/status/startExperiment"===data.address&&$scope.$apply(function(){$scope.maxReady=!0})},SocketIOService.on("oscMessageReceived",this.oscMessageReceivedListener);var thisController=this;$scope.$on("$destroy",function(){SocketIOService.removeListener("oscMessageReceived",thisController.oscMessageReceivedListener),$timeout.cancel(thisController.errorTimeout)}),this.sendExperimentStartMessage=function(){$scope.maxReady=!1,SocketIOService.emit("sendOSCMessage",{oscType:"message",address:"/eim/control/startExperiment",args:{type:"string",value:""+TrialData.data.metadata.session_number}})},this.sendExperimentStartMessage(),this.errorTimeout=$timeout(function(){},1e4),this.errorTimeout.then(function(){if(!$scope.readyToAdvance)throw $scope.addGenericErrorAlert(),new Error("Max had not responded to startExperiment message after 10 seconds")})}]),angular.module("core").directive("checkboxQuestion",["$compile","TrialData",function($compile,TrialData){return{restrict:"E",scope:{},link:function(scope,element,attrs){scope.someSelected=!1,scope.sendToTrialData=function(path,value){attrs.associatedToMedia?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)},scope.updateCheckboxes=function(){for(var newSomeSelectedValue=!1,checkedOptions=[],inputs=element.find("input"),i=0;i<inputs.length;i++){var input=angular.element(inputs[i]);input.attr("name")===attrs.questionId+"Checkbox"&&input.prop("checked")===!0&&(newSomeSelectedValue=!0,checkedOptions.push(input.attr("value").toLowerCase()))}scope.someSelected=newSomeSelectedValue,checkedOptions.sort(),scope.sendToTrialData(attrs.controllerDataPath,checkedOptions)};var questionText='<div class="row well"><div class="col-md-12"><label for="'+attrs.questionId+'Checkbox" translate>'+attrs.questionLabel+"</label><div>",innerQuestionText="";if(element.data("checkboxOptions"))for(var i=0;i<element.data("checkboxOptions").length;i++){var thisOption=element.data("checkboxOptions")[i];innerQuestionText+='<label class="checkbox-inline">',innerQuestionText+='<input type="checkbox" name="'+attrs.questionId+'Checkbox" id="'+attrs.questionId+"Checkbox"+thisOption+'" value="'+thisOption+'" ng-model="'+attrs.questionId+"Checkbox"+thisOption+'" ng-change="updateCheckboxes()"',attrs.questionRequired&&(innerQuestionText+='ng-required="!someSelected"'),innerQuestionText+=">{{'"+thisOption+"' | translate}}</input>",innerQuestionText+="</label>"}questionText+=innerQuestionText+"</div></div></div>";var questionElement=angular.element(questionText);element.append(questionElement),$compile(element.contents())(scope)}}}]),angular.module("core").directive("displayTrialData",function(){return{restrict:"AE",template:'<div class="row trial-data-row"><div class="col-md-12"><h3>Trial Data</h3><pre>{{trialDataJson()}}</pre></div></div>'}}),angular.module("core").directive("dropdownQuestion",["$compile","TrialData",function($compile,TrialData){return{restrict:"E",scope:{},link:function(scope,element,attrs){scope.sendToTrialData=function(path,value){attrs.associatedToMedia?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)},scope[attrs.questionId+"Select"]=null,scope.$watch(attrs.questionId+"Select",function(newValue){scope.sendToTrialData(attrs.controllerDataPath,newValue)});var rowDiv=angular.element('<div class="row well"></div>'),formDiv=angular.element('<div class="col-md-12 form-group"></div>');rowDiv.append(formDiv);var label=angular.element('<label class="control-label" translate>'+attrs.questionLabel+"</label>");label.prop("for",attrs.questionId),formDiv.append(label);var select=angular.element('<select class="form-control" required></select>');if(select.attr("id",attrs.questionId),select.attr("name",attrs.questionId),select.attr("ng-model",attrs.questionId+"Select"),element.data("dropdownOptions")){scope.dropdownOptions=element.data("dropdownOptions");for(var i in element.data("dropdownOptions")){var optionText=element.data("dropdownOptions")[i],option=angular.element('<option>{{ "'+optionText+'" | translate }}</option>');option.attr("value",optionText),select.append(option)}}formDiv.append(select),element.append(rowDiv),$compile(element.contents())(scope)}}}]),angular.module("core").directive("questionnaire",["$compile",function($compile){var buildScaleQuestion=function(item){var questionElement=angular.element("<scale-question></scale-question>");return item.questionId&&questionElement.attr("question-id",item.questionId),item.questionLabel&&questionElement.attr("question-label",item.questionLabel),item.questionLabelType&&questionElement.attr("label-type",item.questionLabelType),item.questionLikertMinimumDescription&&questionElement.attr("minimum-description",item.questionLikertMinimumDescription),item.questionLikertMaximumDescription&&questionElement.attr("maximum-description",item.questionLikertMaximumDescription),item.questionLikertSingleImageSrc&&questionElement.attr("single-img-src",item.questionLikertSingleImageSrc),item.questionLikertLeftImageSrc&&questionElement.attr("left-img-src",item.questionLikertLeftImageSrc),item.questionLikertRightImageSrc&&questionElement.attr("right-img-src",item.questionLikertRightImageSrc),item.questionStoragePath&&questionElement.attr("controller-data-path",item.questionStoragePath),item.questionIsAssociatedToMedia&&questionElement.attr("associated-to-media",item.questionIsAssociatedToMedia),item.questionOptions&&questionElement.data("questionOptions",item.questionOptions),questionElement},buildRadioQuestion=function(item){var questionElement=angular.element("<radio-question></radio-question>");return item.questionId&&questionElement.attr("question-id",item.questionId),item.questionLabel&&questionElement.attr("question-label",item.questionLabel),item.questionStoragePath&&questionElement.attr("controller-data-path",item.questionStoragePath),item.questionIsAssociatedToMedia&&questionElement.attr("associated-to-media",item.questionIsAssociatedToMedia),item.questionRadioOptions&&questionElement.data("radioOptions",item.questionRadioOptions),questionElement},buildDropdownQuestion=function(item){var questionElement=angular.element("<dropdown-question></dropdown-question>");return item.questionId&&questionElement.attr("question-id",item.questionId),item.questionLabel&&questionElement.attr("question-label",item.questionLabel),item.questionIsAssociatedToMedia&&questionElement.attr("associated-to-media",item.questionIsAssociatedToMedia),item.questionStoragePath&&questionElement.attr("controller-data-path",item.questionStoragePath),item.questionDropdownOptions&&questionElement.data("dropdownOptions",item.questionDropdownOptions),questionElement},buildCheckboxQuestion=function(item){var questionElement=angular.element("<checkbox-question></checkbox-question>");return item.questionId&&questionElement.attr("question-id",item.questionId),item.questionLabel&&questionElement.attr("question-label",item.questionLabel),item.questionIsAssociatedToMedia&&questionElement.attr("associated-to-media",item.questionIsAssociatedToMedia),item.questionStoragePath&&questionElement.attr("controller-data-path",item.questionStoragePath),item.questionCheckboxOptions&&questionElement.data("checkboxOptions",item.questionCheckboxOptions),item.hasOwnProperty("questionRequired")&&item.questionRequired!==!0||questionElement.attr("question-required","true"),questionElement};return{restrict:"E",scope:{questionnaireData:"=",questionnaireForm:"="},link:function(scope,element){var data=scope.questionnaireData;if(data.title){var title=angular.element("<h1 translate>"+data.title+"</h1>");element.append(title)}if(data.introductoryText){var introductoryText=angular.element('<div class="row"><div class="col-md-12 introductory-text"><h2 translate>'+data.introductoryText+"</h2></div></div>");element.append(introductoryText)}var formElement=angular.element('<form class="form" name="questionnaireForm" novalidate></form>');element.append(formElement);for(var i=0;i<data.structure.length;i++){var questionElement,item=data.structure[i];switch(item.questionType){case"likert":questionElement=buildScaleQuestion(item);break;case"radio":questionElement=buildRadioQuestion(item);break;case"dropdown":questionElement=buildDropdownQuestion(item);break;case"checkbox":questionElement=buildCheckboxQuestion(item)}var spacerElement=angular.element('<div class="row"><div class="col-md-12 questionSpacer"></div></div>');formElement.append(questionElement),formElement.append(spacerElement)}$compile(element.contents())(scope)}}}]),angular.module("core").directive("radioQuestion",["$compile","TrialData",function($compile,TrialData){return{restrict:"E",scope:{},link:function(scope,element,attrs){scope.sendToTrialData=function(path,value){attrs.associatedToMedia?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)},scope[attrs.questionId+"RadioGroup"]=null,scope.$watch(attrs.questionId+"RadioGroup",function(newValue){"true"===newValue?newValue=!0:"false"===newValue&&(newValue=!1),scope.sendToTrialData(attrs.controllerDataPath,newValue)});var questionText='<div class="row"><div class="col-md-12"><label for="'+attrs.questionId+'Radio" translate>'+attrs.questionLabel+"</label><div>",innerQuestionText="";if(element.data("radioOptions"))for(var i=0;i<element.data("radioOptions").length;i++){var thisOption=element.data("radioOptions")[i];innerQuestionText+='<label class="radio-inline"><input type="radio" name="'+attrs.questionId+'RadioGroup" id="'+attrs.questionId+"Radio"+thisOption.label+'" value="'+thisOption.value+'" ng-model="'+attrs.questionId+'RadioGroup" required="true">{{\''+thisOption.label+"' | translate}}</input></label>";
}questionText+=innerQuestionText+"</div></div></div>";var questionElement=angular.element(questionText);questionElement.addClass("well"),element.append(questionElement),$compile(element.contents())(scope)}}}]),angular.module("core").directive("scaleQuestion",["$compile","TrialData",function($compile,TrialData){var buildDescriptionsRow=function(scope,element,attrs){var descriptions;if(attrs.minimumDescription&&attrs.maximumDescription){descriptions=angular.element("<div></div>"),descriptions.addClass("row"),descriptions.addClass("scale-descriptions");var sideSpacer=angular.element("<div></div>");sideSpacer.addClass("col-md-2");var centerSpacer=angular.element("<div></div>");centerSpacer.addClass("col-md-4");var descriptionsInnerRow=angular.element("<div></div>");descriptionsInnerRow.addClass("col-md-8"),descriptionsInnerRow.addClass("scale-descriptions-inner-row");var fifthsColumnSpacer=angular.element("<div></div>");fifthsColumnSpacer.addClass("col-md-5ths");var leftTextBlock=angular.element("<div translate></div>");leftTextBlock.addClass("col-md-5ths"),leftTextBlock.addClass("small"),leftTextBlock.addClass("text-center"),leftTextBlock.addClass("scale-minimum-description"),leftTextBlock.html(attrs.minimumDescription);var rightTextBlock=leftTextBlock.clone();rightTextBlock.removeClass("scale-minimum-description"),rightTextBlock.addClass("scale-maximum-description"),rightTextBlock.html(attrs.maximumDescription),descriptionsInnerRow.append(leftTextBlock),descriptionsInnerRow.append(fifthsColumnSpacer.clone(),fifthsColumnSpacer.clone(),fifthsColumnSpacer.clone()),descriptionsInnerRow.append(rightTextBlock),descriptions.append(sideSpacer.clone(),descriptionsInnerRow,sideSpacer.clone())}return descriptions};return{restrict:"E",scope:{},link:function(scope,element,attrs){scope.sendToTrialData=function(path,value){attrs.associatedToMedia?TrialData.setValueForPathForCurrentMedia(path,value):TrialData.setValueForPath(path,value)},scope[attrs.questionId+"RadioGroup"]=null,scope.$watch(attrs.questionId+"RadioGroup",function(newValue){scope.sendToTrialData(attrs.controllerDataPath,parseInt(newValue))});var questionHeader;questionHeader="labelLeft"===attrs.labelType?angular.element('<div class="row"><div class="col-md-12"><label translate>'+attrs.questionLabel+"</label></div></div>"):angular.element('<div class="row"><div class="col-md-12 text-center"><h3 translate>'+attrs.questionLabel+"</h3></div></div>");var image;attrs.singleImgSrc?image=angular.element('<div class="row"><div class="col-md-2"></div><div class="col-md-8 text-center"><img src="'+attrs.singleImgSrc+'"></div><div class="col-md-2"></div></div>'):attrs.leftImgSrc&&attrs.rightImgSrc&&(image=angular.element('<div class="row"><div class="col-md-2"></div><div class="col-md-2"><img src="'+attrs.leftImgSrc+'"></div><div class="col-md-4"></div><div class="col-md-2"><img src="'+attrs.rightImgSrc+'"></div><div class="col-md-2"></div></div>'));var optionLabels;if(element.data("questionOptions")&&element.data("questionOptions").choices){var choices=element.data("questionOptions").choices;optionLabels=angular.element('<div class="row"></div>'),optionLabels.append('<div class="col-md-2 option-label-spacer"></div>');for(var centerGroup=angular.element('<div class="col-md-8 option-label-container text-center"></div>'),i=0;i<choices.length;i++){var choiceDiv=angular.element('<div class="col-md-5ths option-label text-center">{{ \''+choices[i].label+"' | translate }}</div>");centerGroup.append(choiceDiv)}optionLabels.append(centerGroup),optionLabels.append('<div class="col-md-2 option-label-spacer"></div>')}for(var innerRadioHTML="",j=1;5>=j;j++)innerRadioHTML+='<div class="col-md-5ths text-center"><input type="radio" name="'+attrs.questionId+'RadioGroup" id="'+attrs.questionId+"RadioGroup"+j+'" value="'+j+'" required ng-model="'+attrs.questionId+'RadioGroup"></div>';var radios=angular.element('<div class="row">\n    <div class="col-md-2"></div>\n    <div class="col-md-8 text-center">\n        '+innerRadioHTML+'<div class="row">\n        </div>\n    </div>\n    <div class="col-md-2"></div>\n</div>'),descriptions=buildDescriptionsRow(scope,element,attrs),wrapperDiv=angular.element('<div class="row well"></div>');wrapperDiv.append(questionHeader,image,optionLabels,radios,descriptions),element.append(wrapperDiv),$compile(element.contents())(scope)}}}]),angular.module("core").factory("ExperimentManager",["TrialData","$q","$http","$state",function(TrialData,$q,$http,$state){return{advanceSlide:function(){TrialData.data.state.currentSlideIndex++,TrialData.data.state.currentSlideIndex===TrialData.data.schema.length?$state.go("home",{},{reload:!0}):$state.go(TrialData.data.schema[TrialData.data.state.currentSlideIndex].name,{},{reload:!0})},masterReset:function(){var deferred=$q.defer();return TrialData.reset(),TrialData.data.metadata.session_number=UUID.generate(),$http.get("/api/experiment-schemas/random").success(function(data){TrialData.data.media=data.media,TrialData.data.schema=data.structure,deferred.resolve()}).error(function(){deferred.reject("An experiment schema could not be fetched from the server")}),deferred.promise}}}]),angular.module("core").factory("SocketIOService",["socketFactory",function(socketFactory){return socketFactory()}]),angular.module("core").factory("TrialData",[function(){function BlankDataObject(){return{answers:{},date:null,media:[],timestamps:{start:null,test:null,media:[],end:null},metadata:{language:"en",session_number:null,location:"taipei_city",terminal:null},state:{currentSlideIndex:-1,mediaPlayCount:0}}}var trialData={data:null,toJson:function(){return angular.toJson(this.data,!0)},reset:function(){this.data=new BlankDataObject},setValueForPath:function(path,value,options){"true"===value?value=!0:"false"===value&&(value=!1);var numericRegex=/\d+\.?\d?/;if("string"==typeof value&&value.match(numericRegex)&&(value=parseFloat(value)),"string"==typeof value&&(value=value.toLowerCase()),path&&void 0!==value){for(var schema=this,pList=path.split("."),len=pList.length,i=0;len-1>i;i++){var elem=pList[i];schema[elem]||(schema[elem]={}),schema=schema[elem]}if(options&&options.hasOwnProperty("array_index")&&"number"==typeof options.array_index){void 0===schema[pList[len-1]]&&(schema[pList[len-1]]=[]);for(var j=0;j<options.array_index;j++)void 0===schema[pList[len-1]][j]&&(schema[pList[len-1]][j]=null);schema[pList[len-1]][options.array_index]=value}else schema[pList[len-1]]=value}},setValueForPathForCurrentMedia:function(path,value){var index;index=this.data.state.mediaPlayCount<=0?0:this.data.state.mediaPlayCount-1,this.setValueForPath(path,value,{array_index:index})},language:function(newLanguage){return"string"==typeof newLanguage&&(this.data.metadata.language=newLanguage),this.data.metadata.language}};return trialData.data=new BlankDataObject,trialData}]);